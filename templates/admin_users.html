<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Users - Medi kart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root { --sidebar-bg: #002b5c; --primary-teal: #00a699; }
        body { font-family: 'Poppins', sans-serif; background-color: #f4f7fa; }
        .sidebar { height: 100vh; width: 260px; position: fixed; background: var(--sidebar-bg); color: white; padding-top: 20px; }
        .sidebar-link { padding: 15px 25px; display: flex; align-items: center; color: rgba(255,255,255,0.7); text-decoration: none; }
        .sidebar-link:hover { background: rgba(255,255,255,0.1); color: white; border-left: 4px solid var(--primary-teal); }
        .main-content { margin-left: 260px; padding: 30px; }
        .table-card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar shadow">
    <div class="px-4 mb-5 text-center">
        <h4 class="fw-bold text-white"><i class="bi bi-capsule-pill me-2 text-primary"></i>Medi kart</h4>
        <small class="text-muted">ADMIN PANEL</small>
    </div>
    <a href="/admin" class="sidebar-link"><i class="bi bi-speedometer2"></i> Dashboard</a>
    <a href="/admin/users" class="sidebar-link active" style="background: rgba(255,255,255,0.1); color: white; border-left: 4px solid var(--primary-teal);"><i class="bi bi-people-fill"></i> Manage Users</a>
    <a href="/" class="sidebar-link"><i class="bi bi-shop"></i> View Shop</a>
    <a href="/logout" class="sidebar-link text-danger mt-5"><i class="bi bi-box-arrow-left"></i> Logout</a>
</div>

<!-- Main Content -->
<div class="main-content">
    <h3 class="fw-bold mb-4">User Account Management</h3>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show rounded-pill" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="table-card">
        <table class="table align-middle">
            <thead class="table-light">
                <tr>
                    <th>User / Reg Date</th>
                    <th>Contact Info</th>
                    <th>Location Tracking</th>
                    <th>Account Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td>
                        <strong>{{ u.username }}</strong><br>
                        <small class="text-muted">{{ u.reg_date.strftime('%d %b %Y') if u.reg_date else 'N/A' }}</small>
                    </td>
                    <td>
                        <i class="bi bi-envelope small text-primary"></i> {{ u.email }}<br>
                        <i class="bi bi-telephone small text-success"></i> {{ u.phone }}
                    </td>
                    <td>
                        <span class="small">
                            <i class="bi bi-geo-alt-fill text-danger"></i> 
                            {{ u.city if u.city else 'City Unknown' }}, {{ u.state if u.state else 'State Unknown' }}
                        </span><br>
                        <small class="text-muted">Lat: {{ u.lat }}, Lng: {{ u.lng }}</small>
                    </td>
                    <td>
                        <span class="badge {% if u.is_active %}bg-success{% else %}bg-danger{% endif %} rounded-pill">
                            {{ 'Active / Verified' if u.is_active else 'Unverified' }}
                        </span>
                    </td>
                    <td>
                        <div class="btn-group">
                            <a href="/admin/toggle_user/{{ u.id }}" class="btn btn-sm btn-outline-warning" title="Toggle Activation">
                                <i class="bi bi-shield-lock"></i>
                            </a>
                            <a href="/admin/delete_user/{{ u.id }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Intha user-ah delete pannalaama?')" title="Delete User">
                                <i class="bi bi-trash3"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>